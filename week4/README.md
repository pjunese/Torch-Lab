# ANN (Approximate Nearest Neighbor) 개념 정리 및 대표 알고리즘 비교

## 1. ANN이란 무엇인가

ANN(Approximate Nearest Neighbor)은 고차원 벡터 공간에서  
“가장 가까운 이웃”을 **정확하게가 아니라, 매우 빠르게 근사적으로 찾는 검색 기법**이다.

이미지, 텍스트, 오디오 같은 데이터는 보통 딥러닝 모델을 거쳐  
수백~수천 차원의 임베딩 벡터로 변환된다.  
이 벡터들을 대상으로 유사한 데이터를 찾는 것이 최근접 이웃 검색 문제이며,  
데이터가 많아질수록 모든 벡터를 하나씩 비교하는 정확 검색(Exact kNN)은 현실적으로 불가능해진다.

ANN은 이 문제를 해결하기 위해  
정확도를 약간 희생하는 대신 속도, 메모리 효율, 확장성을 크게 개선한 방법이다.

---

## 2. ANN에서 중요한 기준

ANN 알고리즘을 평가할 때는 단순히 “정확하다 / 빠르다”가 아니라  
다음 요소들의 균형을 본다.

- Recall@k  
  실제 정답 Top-k 중 ANN 결과가 얼마나 포함되는지
- Latency  
  쿼리 1개당 검색 시간
- Memory usage  
  인덱스가 차지하는 메모리 크기
- Build time  
  인덱스 생성에 걸리는 시간

실제 서비스에서는 보통  
Recall을 어느 정도까지 허용할 것인가와  
얼마나 빠르게 응답해야 하는가 사이의 트레이드오프를 조절한다.

---

## 3. 대표적인 ANN 알고리즘 두 가지

현업과 연구에서 가장 널리 쓰이는 대표적인 접근은 다음 두 축이다.

하나는 **그래프 기반(HNSW)**,  
다른 하나는 **클러스터링 + 압축 기반(IVF-PQ)** 이다.

이 둘은 성격이 뚜렷하게 다르다.

---

## 4. HNSW (Hierarchical Navigable Small World)

HNSW는 벡터들을 노드로 보고  
“서로 가까운 벡터끼리 연결된 그래프”를 구성한 뒤  
그래프를 따라 이동하면서 가까운 이웃을 찾는 방식이다.

검색 과정은  
멀리 있는 지점에서 시작해 점점 가까운 노드로 이동하는 탐색 과정이며,  
그래프 구조 덕분에 매우 빠르게 수렴한다.

HNSW의 가장 큰 장점은  
튜닝이 직관적이고, 매우 높은 Recall을 쉽게 얻을 수 있다는 점이다.

- 탐색 범위를 넓히면 정확도가 올라가고
- 탐색 범위를 줄이면 속도가 빨라진다

이 특성 때문에  
중간 규모 데이터(수십만 ~ 수천만)에서  
“빠른 응답 + 높은 정확도”가 필요한 경우에 자주 사용된다.

단점은  
그래프 연결 정보를 저장해야 하므로  
메모리 사용량이 상대적으로 크다는 점이다.

---

## 5. IVF-PQ (Inverted File + Product Quantization)

IVF-PQ는 ANN의 또 다른 대표적인 계열로,  
“검색 범위를 줄이는 방법”과 “벡터를 압축하는 방법”을 동시에 사용한다.

먼저 IVF(Inverted File) 단계에서  
전체 벡터 공간을 여러 개의 클러스터로 나눈다.  
쿼리가 들어오면, 모든 데이터를 검색하지 않고  
가까운 몇 개의 클러스터만 탐색한다.

그 다음 PQ(Product Quantization) 단계에서는  
각 벡터를 여러 조각으로 나눈 뒤  
각 조각을 코드북 인덱스로 압축해 저장한다.

이 방식의 핵심 장점은  
메모리 사용량이 매우 작고,  
수천만~수억 단위 데이터에서도 안정적으로 동작한다는 점이다.

대신  
- 학습 단계가 필요하고
- 파라미터 튜닝이 비교적 중요하며
- HNSW 대비 정확도가 약간 낮을 수 있다

그래서 IVF-PQ는  
“초대규모 데이터”나  
“비용·메모리 제약이 중요한 서비스”에서 많이 사용된다.

---

## 6. 두 알고리즘의 성격 비교 (정리)

HNSW는  
빠르게 만들고, 튜닝도 쉽고, 정확도도 잘 나오는 방식이다.  
프로토타입이나 중대형 서비스에서 특히 유용하다.

IVF-PQ는  
아주 큰 데이터에서도 메모리를 아끼며 확장 가능한 방식이다.  
대규모 검색 시스템의 최종 형태로 자주 사용된다.

실제 현업에서는  
- 초기에 HNSW로 성능을 검증하고  
- 데이터가 커지면 IVF-PQ로 이전하는 경우도 많다.

---

## 7. 실습 코드 개요

이 저장소에서는 ANN의 대표적인 두 구현을 파이썬으로 다룬다.

- HNSW 기반 ANN (FAISS IndexHNSWFlat)
- IVF-PQ 기반 ANN (FAISS IndexIVFPQ)

두 코드 모두 다음 흐름을 따른다.

1. 임의의 고차원 벡터 데이터 생성  
2. 코사인 유사도를 위한 정규화  
3. ANN 인덱스 생성 및 빌드  
4. 쿼리 벡터에 대한 Top-k 검색  

이를 통해  
ANN이 실제로 어떻게 동작하는지,  
그리고 파라미터에 따라 성능이 어떻게 달라지는지를 직접 확인할 수 있다.

---


